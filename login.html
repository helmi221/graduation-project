<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ููุฌุฑุฉ | ุชุณุฌูู ุงูุฏุฎูู</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <nav class="container">
        <a href="index.html" class="logo">ููุฌุฑุฉ</a>
        <div class="nav-items">
          <ul class="desktop-nav">
            <li>
              <a href="index.html" class="nav-link">ุงูุฑุฆูุณูุฉ</a>
            </li>
            <li>
              <a href="products.html" class="nav-link">ููุชุฌุงุชูุง</a>
            </li>
            <li><a href="order-status.html" class="nav-link">ุญุงูุฉ ุงูุทูุจ</a></li>
            <li>
              <a href="recommendation.html" class="nav-link">ุงููุฌุงุฑ ุงูุฐูู</a>
            </li>
            <li><a href="design.html" class="nav-link">ุตูู ููุชุฌู</a></li>
          </ul>

          <div class="auth-nav">
            <a href="cart.html" class="cart-icon-wrapper">
              <i class="fa-solid fa-bag-shopping" id="cart-icon"></i>
              <span id="cart-count-badge">0</span>
            </a>
            <div class="profile-dropdown" id="profile-dropdown">
              <div class="profile-icon">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <span id="user-display-name">ูุฑุญุจุงู ุจู</span>
                  <p id="user-email">ุฒุงุฆุฑ</p>
                </div>
                <a href="login.html" id="auth-link">ุชุณุฌูู ุงูุฏุฎูู</a>
                <a href="#" id="logout-link" style="display: none"
                  >ุชุณุฌูู ุงูุฎุฑูุฌ</a
                >
              </div>
            </div>
          </div>

          <button class="menu-toggle" id="menu-toggle">
            <div class="hamburger-icon">
              <span></span><span></span><span></span>
            </div>
          </button>
        </div>
      </nav>
    </header>

    <div class="mobile-menu" id="mobile-menu">
      <a href="index.html" class="nav-link">ุงูุฑุฆูุณูุฉ</a>
      <a href="products.html" class="nav-link">ููุชุฌุงุชูุง</a>
      <a href="order-status.html" class="nav-link">ุญุงูุฉ ุงูุทูุจ</a>
      <a href="recommendation.html" class="nav-link">ุงููุฌุงุฑ ุงูุฐูู</a>
      <a href="design.html" class="nav-link">ุตูู ููุชุฌู</a>
    </div>

    <main>
      <section class="container auth-section">
        <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
        <form id="login-form" class="auth-form">
          <div class="form-group">
            <label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
            <input type="email" id="email" required />
          </div>
          <div class="form-group">
            <label for="password">ูููุฉ ุงููุฑูุฑ</label>
            <input type="password" id="password" required />
          </div>
          <button type="submit" class="btn">ุชุณุฌูู ุงูุฏุฎูู</button>
        </form>
        <div class="auth-link">
          <p>ููุณ ูุฏูู ุญุณุงุจุ <a href="signup.html">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</a></p>
        </div>
      </section>
    </main>

    <footer>
      <div class="container footer-content">
        <a href="index.html" class="footer-logo">ููุฌุฑุฉ</a>
        <div class="footer-links">
          <a href="#">ูู ูุญู</a> <a href="#">ุชูุงุตู ูุนูุง</a>
        </div>
      </div>
      <div class="copyright">&copy; 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ.</div>
    </footer>

    <script type="module">
      // --- ๐ก (ุฌุฏูุฏ) ููุฏ ุงููุงุฌูุฉ (ููุฏุฑ + ุณูุฉ) ---
      import {
        getAuth,
        onAuthStateChanged,
        signInWithEmailAndPassword, // ๐ก (ูุฏูุฌ)
        signOut,
      } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";

      // (ุฅุนุฏุงุฏุงุช Firebase ููุง ูู)
      const firebaseConfig = {
        apiKey: "AIzaSyBL7MOIEE8K1UgZTG_j-6-VM0JzlD_7BS0",
        authDomain: "ecomers-dd329.firebaseapp.com",
        projectId: "ecomers-dd329",
        storageBucket: "ecomers-dd329.firebasestorage.app",
        messagingSenderId: "190646144215",
        appId: "1:190646144215:web:d55f24091a920f92b6b492",
        measurementId: "G-NVYK3DZR00",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // (ุนูุงุตุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู)
      const userDisplayName = document.getElementById("user-display-name");
      const userEmail = document.getElementById("user-email");
      const authLink = document.getElementById("auth-link");
      const logoutLink = document.getElementById("logout-link");
      const cartCountBadge = document.getElementById("cart-count-badge");
      const menuToggle = document.getElementById("menu-toggle");
      const mobileMenu = document.getElementById("mobile-menu");

      // (ููุทู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ)
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          const userDocRef = doc(db, "users", user.uid);
          const userDocSnap = await getDoc(userDocRef);
          let userName = "ูุณุชุฎุฏู";
          if (userDocSnap.exists()) {
            userName = userDocSnap.data().name || userName;
          }
          userDisplayName.textContent = "ูุฑุญุจุงู " + userName;
          userEmail.textContent = user.email;
          authLink.style.display = "none";
          logoutLink.style.display = "block";
          logoutLink.onclick = async (e) => {
            e.preventDefault();
            await signOut(auth);
            window.location.href = "index.html";
          };
        } else {
          userDisplayName.textContent = "ูุฑุญุจุงู ุจู";
          userEmail.textContent = "ุฒุงุฆุฑ";
          authLink.style.display = "block";
          logoutLink.style.display = "none";
        }
      });

      // (ููุทู ุงูุณูุฉ ูุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ)
      function loadCartAndUpdateBadge() {
        const storedCart = localStorage.getItem("shoppingCart") || "[]";
        const cart = JSON.parse(storedCart);
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCountBadge.textContent = totalItems;
        cartCountBadge.classList.toggle("visible", totalItems > 0);
      }
      document.addEventListener("DOMContentLoaded", () => {
        loadCartAndUpdateBadge();
        menuToggle.addEventListener("click", () => {
          mobileMenu.classList.toggle("active");
          document.body.classList.toggle("scroll-lock");
        });
      });

      // --- (ูุฐุง ุงูููุฏ ูู ููู login.html ุงููุฏูู) ---
      const loginForm = document.getElementById("login-form");

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = loginForm.email.value;
        const password = loginForm.password.value;
        try {
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists() && userDoc.data().role === "admin") {
            window.location.href = "admin.html"; // ๐ก ุชูุฌูู ุงููุฏูุฑ
          } else {
            window.location.href = "index.html"; // ๐ก ุชูุฌูู ุงูุนููู
          }
        } catch (error) {
          alert("ูุดู ุชุณุฌูู ุงูุฏุฎูู: " + error.message);
        }
      });
    </script>
  </body>
</html>
