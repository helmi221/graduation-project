<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ù†Ø¬Ø±Ø© | Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* ğŸ’¡ (Ù…Ø¹Ø¯Ù„) Ø£Ù†Ù…Ø§Ø· Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ */
      .order-check-section {
        max-width: 900px;
        margin: 5rem auto;
        padding: 40px;
        background-color: var(--white-color);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        text-align: right;
      }
      .order-check-section h2,
      .order-check-section p {
        text-align: center;
      }
      .order-status-result-container {
        margin-top: 2rem;
        padding: 20px 0;
      }
      .order-card {
        background-color: var(--white-color);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        padding: 25px;
        margin-bottom: 25px;
        position: relative;
        overflow: hidden;
      }
      .order-card::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        width: 6px;
        background-color: var(--primary-color);
      }
      /* (Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª) */
      .order-card.status-Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„::before,
      .order-card.status-Ù…ÙƒØªÙ…Ù„::before {
        background-color: #27ae60;
      }
      .order-card.status-Ù‚ÙŠØ¯-Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©::before {
        background-color: #f1c40f;
      }
      .order-card.status-Ù‚ÙŠØ¯-Ø§Ù„ØªÙ†ÙÙŠØ°::before {
        background-color: #3498db;
      }
      .order-card.status-ØªÙ…-Ø§Ù„Ø±ÙØ¶::before,
      .order-card.status-Ù…Ø±ÙÙˆØ¶-Ø§Ù„Ø¹Ù…ÙŠÙ„::before {
        background-color: #e74c3c;
      }

      .order-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 15px;
      }
      .order-id {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--dark-color);
      }
      .order-id i {
        color: var(--primary-color);
        margin-left: 10px;
      }
      .order-type {
        font-size: 0.9rem;
        color: #777;
        margin-top: 5px;
      }
      .status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.9rem;
        color: white;
        text-align: center;
        background-color: #34495e;
      }
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© {
        background-color: #ffeb3b;
        color: #3e2723;
      }
      .status-badge.Ù…Ù‚Ø¨ÙˆÙ„ {
        background-color: #2ecc71;
      }
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„ØªØµÙ†ÙŠØ¹,
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„Ø·Ù„Ø§Ø¡,
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„ØªØºÙ„ÙŠÙ,
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„Ø´Ø­Ù†,
      .status-badge.Ù‚ÙŠØ¯-Ø§Ù„ØªÙ†ÙÙŠØ° {
        background-color: #3498db;
      }
      .status-badge.Ù…ÙƒØªÙ…Ù„,
      .status-badge.Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„ {
        background-color: #27ae60;
      }
      .status-badge.ØªÙ…-Ø§Ù„Ø±ÙØ¶,
      .status-badge.Ù…Ø±ÙÙˆØ¶-Ø§Ù„Ø¹Ù…ÙŠÙ„ {
        background-color: #c0392b;
      }
      .order-details-list {
        list-style: none;
        padding: 0;
        margin-top: 10px;
      }
      .order-details-list li {
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
        font-size: 1rem;
        display: flex;
        justify-content: space-between;
      }
      .order-details-list li:last-child {
        border-bottom: none;
      }
      .custom-design-details {
        margin-top: 15px;
        padding: 15px;
        background-color: var(--light-color);
        border-radius: var(--border-radius);
        border: 1px dashed var(--accent-color);
      }
      .custom-design-details p {
        margin-bottom: 5px;
        font-size: 0.95rem;
      }
      /* (Ù…Ø¹Ø¯Ù„) ØªØµÙ…ÙŠÙ… Ø´Ø±ÙŠØ· Ø§Ù„ÙˆÙ‚Øª */
      .estimated-time-bar {
        background-color: var(--light-color);
        padding: 15px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        border: 1px solid var(--border-color);
        color: var(--dark-color);
      }
      .estimated-time-bar strong {
        color: var(--primary-color);
      }
      /* (Ù…Ø¹Ø¯Ù„) ØªØµÙ…ÙŠÙ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„Ø±ÙØ¶ */
      .price-buttons {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .price-buttons p {
        width: 100%;
        text-align: center;
        font-weight: 600;
      }
      .price-buttons .btn {
        font-family: "Cairo", sans-serif;
        padding: 10px 20px;
      }
      .btn-success {
        background-color: var(--success-color);
      }
      .btn-success:hover {
        background-color: #388e3c;
      }
      .btn-danger {
        background-color: #e74c3c;
      }
      .btn-danger:hover {
        background-color: #c0392b;
      }
      @media (max-width: 768px) {
        .order-card-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
        .order-id {
          font-size: 1.1rem;
        }
        .order-type {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="container">
        <a href="index.html" class="logo">Ù…Ù†Ø¬Ø±Ø©</a>
        <div class="nav-items">
          <ul class="desktop-nav">
            <li>
              <a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </li>
            <li>
              <a href="products.html" class="nav-link">Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</a>
            </li>
            <li>
              <a href="order-status.html" class="nav-link active">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</a>
            </li>
            <li>
              <a href="recommendation.html" class="nav-link">Ø§Ù„Ù†Ø¬Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</a>
            </li>
            <li><a href="design.html" class="nav-link">ØµÙ…Ù… Ù…Ù†ØªØ¬Ùƒ</a></li>
          </ul>

          <div class="auth-nav">
            <a href="cart.html" class="cart-icon-wrapper">
              <i class="fa-solid fa-bag-shopping" id="cart-icon"></i>
              <span id="cart-count-badge">0</span>
            </a>

            <div class="profile-dropdown" id="profile-dropdown">
              <div class="profile-icon">
                <i class="fa-solid fa-user"></i>
              </div>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <span id="user-display-name">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</span>
                  <p id="user-email">Ø²Ø§Ø¦Ø±</p>
                </div>
                <a href="login.html" id="auth-link">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <a href="#" id="logout-link" style="display: none"
                  >ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a
                >
              </div>
            </div>
          </div>

          <button class="menu-toggle" id="menu-toggle">
            <div class="hamburger-icon">
              <span></span><span></span><span></span>
            </div>
          </button>
        </div>
      </nav>
    </header>

    <div class="mobile-menu" id="mobile-menu">
      <a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="products.html" class="nav-link">Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</a>
      <a href="order-status.html" class="nav-link">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</a>
      <a href="recommendation.html" class="nav-link">Ø§Ù„Ù†Ø¬Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</a>
      <a href="design.html" class="nav-link">ØµÙ…Ù… Ù…Ù†ØªØ¬Ùƒ</a>
    </div>

    <main>
      <div class="section container order-check-section">
        <div class="section-title-wrapper">
          <h2>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
        </div>
        <div id="order-status-result" class="order-status-result-container">
          <p>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ.</p>
        </div>
      </div>
    </main>

    <footer>
      <div class="container footer-content">
        <a href="index.html" class="footer-logo">Ù…Ù†Ø¬Ø±Ø©</a>
        <div class="footer-links">
          <a href="#">Ù…Ù† Ù†Ø­Ù†</a> <a href="#">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        </div>
      </div>
      <div class="copyright">&copy; 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
    </footer>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        query,
        where,
        getDocs,
        orderBy,
        doc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      // ğŸ’¡ (Ø¬Ø¯ÙŠØ¯) Ø¥Ø¶Ø§ÙØ© getDoc Ù„Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      import { getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBL7MOIEE8K1UgZTG_j-6-VM0JzlD_7BS0",
        authDomain: "ecomers-dd329.firebaseapp.com",
        projectId: "ecomers-dd329",
        storageBucket: "ecomers-dd329.firebasestorage.app",
        messagingSenderId: "190646144215",
        appId: "1:190646144215:web:d55f24091a920f92b6b492",
        measurementId: "G-NVYK3DZR00",
      };
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      const orderStatusResult = document.getElementById("order-status-result");
      let cart = [];
      let allOrdersGlobal = [];
      let allProductsGlobal = [];

      // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      const userDisplayName = document.getElementById("user-display-name");
      const userEmail = document.getElementById("user-email");
      const authLink = document.getElementById("auth-link");
      const logoutLink = document.getElementById("logout-link");

      // (Ø§Ù„Ø«ÙˆØ§Ø¨Øª ÙˆØ¯ÙˆØ§Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª ÙƒÙ…Ø§ Ù‡ÙŠ)
      const WORK_HOURS_PER_DAY = 8;
      const DEFAULT_HOURS_READY_PRODUCT = 5;
      const DEFAULT_HOURS_CUSTOM_PRODUCT = 20;
      const PROCESSING_BUFFER_DAYS = 2;

      function getHoursForOrder(order, allProducts) {
        if (
          order.manufacturing_time_override &&
          order.manufacturing_time_override > 0
        ) {
          return parseFloat(order.manufacturing_time_override);
        }
        let totalHours = 0;
        try {
          if (order.type === "ready" && order.items) {
            order.items.forEach((item) => {
              const product = allProducts.find(
                (p) => p.id == item.id || p.id == parseInt(item.id)
              );
              const itemQuantity = item.quantity || 1;
              if (product && product.manufacturing_time_hours > 0) {
                totalHours += product.manufacturing_time_hours * itemQuantity;
              } else {
                totalHours += DEFAULT_HOURS_READY_PRODUCT * itemQuantity;
              }
            });
          } else if (order.type === "custom") {
            totalHours = DEFAULT_HOURS_CUSTOM_PRODUCT;
          }
        } catch (e) {
          console.error("Error calculating hours for order:", order.id, e);
          totalHours = DEFAULT_HOURS_READY_PRODUCT;
        }
        return totalHours > 0 ? totalHours : DEFAULT_HOURS_READY_PRODUCT;
      }

      function calculateEstimatedCompletionDays(
        targetOrder,
        allOrders,
        allProducts
      ) {
        if (!targetOrder) {
          return { minDays: "---", maxDays: "---" };
        }
        const targetOrderHours = getHoursForOrder(targetOrder, allProducts);
        const IN_QUEUE_STATUSES = [
          "Ù…Ù‚Ø¨ÙˆÙ„",
          "Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„",
          "Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠØ¹",
          "Ù‚ÙŠØ¯ Ø§Ù„Ø·Ù„Ø§Ø¡",
          "Ù‚ÙŠØ¯ Ø§Ù„ØªØºÙ„ÙŠÙ",
        ];
        const PENDING_STATUSES = ["Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"];
        let acceptedQueueHours = 0;
        let pendingQueueHours = 0;

        allOrders.forEach((order) => {
          if (order.id === targetOrder.id) return;
          const orderHours = getHoursForOrder(order, allProducts);
          if (orderHours === 0) return;
          if (IN_QUEUE_STATUSES.includes(order.status)) {
            acceptedQueueHours += orderHours;
          }
          if (PENDING_STATUSES.includes(order.status)) {
            const orderDate = new Date(order.order_date);
            const targetOrderDate = new Date(targetOrder.order_date);
            if (orderDate < targetOrderDate) {
              pendingQueueHours += orderHours;
            }
          }
        });

        let minTotalDays, maxTotalDays;
        const targetOrderDays = Math.ceil(
          targetOrderHours / WORK_HOURS_PER_DAY
        );
        const acceptedQueueDays = Math.ceil(
          acceptedQueueHours / WORK_HOURS_PER_DAY
        );
        const pendingQueueDays = Math.ceil(
          pendingQueueHours / WORK_HOURS_PER_DAY
        );

        if (IN_QUEUE_STATUSES.includes(targetOrder.status)) {
          const totalQueueHours = acceptedQueueHours + targetOrderHours;
          minTotalDays =
            Math.ceil(totalQueueHours / WORK_HOURS_PER_DAY) +
            PROCESSING_BUFFER_DAYS;
          maxTotalDays = minTotalDays;
        } else {
          minTotalDays =
            acceptedQueueDays + targetOrderDays + PROCESSING_BUFFER_DAYS;
          maxTotalDays =
            acceptedQueueDays +
            pendingQueueDays +
            targetOrderDays +
            PROCESSING_BUFFER_DAYS;
        }
        return {
          minDays: Math.ceil(minTotalDays),
          maxDays: Math.ceil(maxTotalDays),
          isCalculable: true,
        };
      }

      // (Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ)
      async function fetchSystemData() {
        const [productsSnap, ordersSnap, customSnap] = await Promise.all([
          getDocs(collection(db, "products")),
          getDocs(collection(db, "orders")),
          getDocs(collection(db, "custom_designs")),
        ]);
        allProductsGlobal = productsSnap.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
          manufacturing_time_hours: parseFloat(
            doc.data().manufacturing_time_hours || 0
          ),
        }));
        const readyOrders = ordersSnap.docs.map((d) => ({
          id: d.id,
          type: "ready",
          ...d.data(),
        }));
        const customOrders = customSnap.docs.map((d) => ({
          id: d.id,
          type: "custom",
          ...d.data(),
        }));
        allOrdersGlobal = [...readyOrders, ...customOrders];
      }

      // (Ù…Ù†Ø·Ù‚ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙƒÙ…Ø§ Ù‡Ùˆ)
      const handlePriceDecision = async (orderId, collectionName, status) => {
        try {
          const orderRef = doc(db, collectionName, orderId);
          let updatePayload = { status: status };
          if (status === "Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„") {
            updatePayload.acceptance_date = new Date().toISOString();
          }
          await updateDoc(orderRef, updatePayload);
          alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ùƒ Ø¥Ù„Ù‰: ${status}`);
          location.reload();
        } catch (e) {
          console.error("Error updating order status: ", e);
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        }
      };

      onAuthStateChanged(auth, async (user) => {
        // ğŸ’¡ (Ø¬Ø¯ÙŠØ¯) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        if (user) {
          const userDocRef = doc(db, "users", user.uid);
          const userDocSnap = await getDoc(userDocRef);
          let userName = "Ù…Ø³ØªØ®Ø¯Ù…";
          if (userDocSnap.exists()) {
            userName = userDocSnap.data().name || userName;
          }
          userDisplayName.textContent = "Ù…Ø±Ø­Ø¨Ø§Ù‹ " + userName;
          userEmail.textContent = user.email;
          authLink.style.display = "none";
          logoutLink.style.display = "block";
          logoutLink.onclick = async (e) => {
            e.preventDefault();
            await signOut(auth);
            window.location.href = "index.html";
          };
        } else {
          userDisplayName.textContent = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ";
          userEmail.textContent = "Ø²Ø§Ø¦Ø±";
          authLink.style.display = "block";
          logoutLink.style.display = "none";
        }

        // (Ù…Ù†Ø·Ù‚ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª)
        if (user) {
          await fetchSystemData();
          orderStatusResult.innerHTML =
            "<h2 style='text-align: center;'>Ø·Ù„Ø¨Ø§ØªÙŠ</h2>";
          const ordersCollection = collection(db, "orders");
          const customDesignsCollection = collection(db, "custom_designs");
          const q1 = query(
            ordersCollection,
            where("customer_uid", "==", user.uid)
          );
          const q2 = query(
            customDesignsCollection,
            where("customer_uid", "==", user.uid)
          );
          const [ordersSnapshot, customDesignsSnapshot] = await Promise.all([
            getDocs(q1),
            getDocs(q2),
          ]);
          const customerOrders = [];
          ordersSnapshot.forEach((doc) =>
            customerOrders.push({ ...doc.data(), id: doc.id, type: "ready" })
          );
          customDesignsSnapshot.forEach((doc) =>
            customerOrders.push({ ...doc.data(), id: doc.id, type: "custom" })
          );
          customerOrders.sort(
            (a, b) => new Date(b.order_date) - new Date(a.order_date)
          );

          if (customerOrders.length === 0) {
            orderStatusResult.innerHTML += "<p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</p>";
          } else {
            let resultHTML = "";
            customerOrders.forEach((orderData) => {
              const simplifiedStatus = simplifyStatus(orderData.status);
              const statusClass = simplifiedStatus.replace(/\s+/g, "-");
              const orderType =
                orderData.type === "ready" ? "Ù…Ù†ØªØ¬ Ø¬Ø§Ù‡Ø²" : "ØªØµÙ…ÙŠÙ… Ù…Ø®ØµØµ";
              const estimatedTime = calculateEstimatedCompletionDays(
                orderData,
                allOrdersGlobal,
                allProductsGlobal
              );
              let timeBarHTML = "";
              const nonFinalStatuses = [
                "Ù…Ù‚Ø¨ÙˆÙ„",
                "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
                "Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„",
                "Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠØ¹",
                "Ù‚ÙŠØ¯ Ø§Ù„Ø·Ù„Ø§Ø¡",
                "Ù‚ÙŠØ¯ Ø§Ù„ØªØºÙ„ÙŠÙ",
                "Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù†",
                "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
              ];
              if (
                nonFinalStatuses.includes(simplifiedStatus) &&
                estimatedTime.isCalculable
              ) {
                timeBarHTML = `
                    <div class="estimated-time-bar">
                        <p><strong><i class="fa-solid fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„ØªØ³Ù„ÙŠÙ…:</strong></p>
                        <p>
                            Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: <strong>${estimatedTime.minDays} Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</strong>
                        </p>
                        <p>
                            Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: <strong>${estimatedTime.maxDays} Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</strong>
                        </p>
                        <p style="font-size: 0.8rem; color: #777; margin-top: 5px;">*Ù‡Ø°Ø§ ÙˆÙ‚Øª ØªÙ‚Ø¯ÙŠØ±ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¶ØºØ· Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ.</p>
                    </div>
                  `;
              }
              let itemsListHTML = "";
              let totalDisplay = "";
              let actionsHtml = "";
              if (orderData.type === "ready") {
                itemsListHTML = orderData.items
                  .map(
                    (item) =>
                      `<li><span>${item.name} (Ø§Ù„Ø¹Ø¯Ø¯: ${item.quantity})</span><span>${item.price} Ø´ÙŠÙƒÙ„</span></li>`
                  )
                  .join("");
                totalDisplay = `<p style="margin-top: 15px; font-weight: 700; font-size: 1.1rem;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${orderData.total} Ø´ÙŠÙƒÙ„</p>`;
              } else {
                itemsListHTML = `
                      <div class="custom-design-details">
                          <p><strong><i class="fa-solid fa-list-check"></i> ÙˆØµÙ Ø§Ù„ØªØµÙ…ÙŠÙ…:</strong> ${
                            orderData.notes
                          }</p>
                          <p><strong><i class="fa-solid fa-chair"></i> Ø§Ù„Ù†ÙˆØ¹:</strong> ${
                            orderData.type_of_product || "---"
                          }</p>
                          <p><strong><i class="fa-solid fa-ruler-combined"></i> Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯:</strong> ${
                            orderData.dimensions || "---"
                          }</p>
                          <p><strong><i class="fa-solid fa-tree"></i> Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> ${
                            orderData.material || "---"
                          }</p>
                          <p><strong><i class="fa-solid fa-palette"></i> Ø§Ù„Ù„ÙˆÙ†:</strong> ${
                            orderData.color || "---"
                          }</p>
                      </div>
                  `;
                if (orderData.status === "Ù…Ù‚Ø¨ÙˆÙ„" && orderData.final_price) {
                  totalDisplay = `<p style="font-weight: 700; font-size: 1.1rem;"><i class="fa-solid fa-hand-holding-dollar"></i> Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span style="color: var(--success-color);">${orderData.final_price} Ø´ÙŠÙƒÙ„</span></p>`;
                  actionsHtml = `
                    <div class="price-buttons">
                      <p>Ù„Ù‚Ø¯ Ù‚Ø§Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨ØªØ³Ø¹ÙŠØ± Ø·Ù„Ø¨Ùƒ. Ù‡Ù„ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ</p>
                      <button class="btn btn-success" data-id="${orderData.id}" data-collection="custom_designs" data-status="Ù…Ù‚Ø¨ÙˆÙ„-Ø§Ù„Ø¹Ù…ÙŠÙ„">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³Ø¹Ø±</button>
                      <button class="btn btn-danger" data-id="${orderData.id}" data-collection="custom_designs" data-status="Ù…Ø±ÙÙˆØ¶-Ø§Ù„Ø¹Ù…ÙŠÙ„">Ø±ÙØ¶ Ø§Ù„Ø³Ø¹Ø±</button>
                    </div>
                  `;
                } else if (
                  orderData.status === "ØªÙ… Ø§Ù„Ø±ÙØ¶" &&
                  orderData.rejection_reason
                ) {
                  totalDisplay = `<p style="font-weight: 700; font-size: 1.1rem;"><i class="fa-solid fa-hand-holding-dollar"></i> Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ: ${
                    orderData.initial_price || orderData.price
                  }</p>`;
                  itemsListHTML += `<p style="color:red; margin-top: 10px; font-weight: 600;"><i class="fa-solid fa-circle-xmark"></i> Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶: ${orderData.rejection_reason}</p>`;
                } else {
                  totalDisplay = `<p style="font-weight: 700; font-size: 1.1rem;"><i class="fa-solid fa-hand-holding-dollar"></i> Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­: ${
                    orderData.initial_price || orderData.price
                  }</p>`;
                }
              }
              resultHTML += `
                <div class="order-card status-${statusClass}">
                    <div class="order-card-header">
                        <div>
                            <p class="order-id"><i class="fa-solid fa-receipt"></i> Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${
                              orderData.id
                            }</p>
                            <p class="order-type">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨: ${orderType}</p>
                        </div>
                        <span class="status-badge ${statusClass}">${simplifiedStatus}</span>
                    </div>
                    <div class="order-card-body">
                        <p><strong><i class="fa-solid fa-calendar-alt"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(
                          orderData.order_date
                        ).toLocaleDateString("en-US")}</p>
                        ${timeBarHTML}
                        ${
                          orderData.type === "ready"
                            ? `<h4 style="margin-top: 15px;"><i class="fa-solid fa-boxes-stacked"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h4>`
                            : ""
                        }
                        <ul class="order-details-list">
                            ${itemsListHTML}
                        </ul>
                        ${totalDisplay}
                        ${actionsHtml}
                    </div>
                </div>
              `;
            });
            orderStatusResult.innerHTML += resultHTML;
            document
              .querySelectorAll(".price-buttons .btn")
              .forEach((button) => {
                button.addEventListener("click", (e) => {
                  const id = e.target.dataset.id;
                  const collection = e.target.dataset.collection;
                  const status = e.target.dataset.status;
                  handlePriceDecision(id, collection, status);
                });
              });
          }
        } else {
          orderStatusResult.innerHTML =
            "<p>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ.</p><a href='login.html' class='btn'>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>";
        }
      });

      const simplifyStatus = (status) => {
        if (["Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠØ¹", "Ù‚ÙŠØ¯ Ø§Ù„Ø·Ù„Ø§Ø¡", "Ù‚ÙŠØ¯ Ø§Ù„ØªØºÙ„ÙŠÙ"].includes(status)) {
          return "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°";
        }
        return status;
      };

      // (Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙƒÙ…Ø§ Ù‡ÙŠ)
      function loadCart() {
        const storedCart = localStorage.getItem("shoppingCart");
        cart = storedCart ? JSON.parse(storedCart) : [];
      }
      function updateCartBadge() {
        const cartCountBadge = document.getElementById("cart-count-badge");
        if (!cartCountBadge) return;
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCountBadge.textContent = totalItems;
        cartCountBadge.classList.toggle("visible", totalItems > 0);
      }
      document.addEventListener("DOMContentLoaded", () => {
        loadCart();
        updateCartBadge();
        const menuToggle = document.getElementById("menu-toggle");
        const mobileMenu = document.getElementById("mobile-menu");
        const body = document.body;
        menuToggle.addEventListener("click", () => {
          mobileMenu.classList.toggle("active");
          body.classList.toggle("scroll-lock");
        });
      });
    </script>
  </body>
</html>
